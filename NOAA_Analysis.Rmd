---
title: "Analysis of the NOAA Storm Database and study the influence of the storm on health and economy"
output: html_document
author: Dmitry
---

##Synopsis

Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.
In this document storms and other severe weather events from the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database are analyzed. Using whole data from 1950 to November 2011 questions about severe weather events were studied. The most harmful type of events with respect to population health and type of events with the greatest economic consequences were determined.
For study was used this version pf database file:
https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2 and description: https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf


##Data Processing
For analysis this reference was used:
https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2

###Getting data
At the first, the datafile was downloaded and read.

```{r, cache=TRUE}
DataUrl <-  "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
fileName <- paste0(getwd(), "/../StormData.csv.bz2")
if(!file.exists(fileName)){
    download.file(DataUrl, fileName)
    }
NOAA_data <- read.csv(bzfile(fileName))
```

### Structure of data
There are several first lines of data presented to see structure of the data
```{r}
head(NOAA_data)
```

Our study should answer two queston:
  
* Across the United States, which types of events (as indicated in the `EVTYPE` variable) are most harmful with respect to population health?
  
* Across the United States, which types of events have the greatest economic consequences?

Therefore for this study will be useful next column: `EVTYPE` `FATALITIES` 
`INJURIES` `PROPDMG` `CROPDMG` `PROPDMGEXP` `CROPDMGEXP`


`PROPDMGEXP` `CROPDMGEXP` indicate, who damage could be calculated. There are severel types of data in these column.

```{r}
NOAA_data$PROPDMGEXP <- as.factor(NOAA_data$PROPDMGEXP)
NOAA_data$CROPDMGEXP <- as.factor(NOAA_data$CROPDMGEXP)

print(levels(NOAA_data$PROPDMGEXP))
print(levels(NOAA_data$CROPDMGEXP))

powIndicator <- levels(as.factor(c(levels(NOAA_data$PROPDMGEXP),
                                   levels(NOAA_data$CROPDMGEXP))))[-1:-4]
print(powIndicator)
```

Damage can be calculated as `Expense = A * 10^B`, where A is number from `CROPDMG`/`PROPDMG` field and B is exponential values from table. Numbers are simply B-value, `h/H` for hundreds,`k/K` for thousands, etc.

```{r, results='asis'}
library("xtable")
ConvTable<-data.frame(DMGEXP = powIndicator, B = c(0,1,2,3,4,5,6,7,8,9,2,2,3,3,6,6))
xt <- xtable(ConvTable)
print(xt, type="html",include.rownames=FALSE)

```

For our purposes `PROPDMG` `CROPDMG` field were recalculated acording this table to compute the total losses.

```{r}

for (e in ConvTable$DMGEXP){
    NOAA_data$PROPDMG[NOAA_data$PROPDMGEXP == e] <-
        NOAA_data$PROPDMG[NOAA_data$PROPDMGEXP == e]* 10 ^ ConvTable$B[ConvTable$DMGEXP == e]
    
    NOAA_data$CROPDMG[NOAA_data$CROPDMGEXP == e] <-
        NOAA_data$CROPDMG[NOAA_data$CROPDMGEXP == e]* 10 ^ ConvTable$B[ConvTable$DMGEXP == e]
}

```

### Search most harmful type of event
```{r}
answ1 <- aggregate(NOAA_data$CROPDMG, by=list(Category=FitbitData$EVTYPE), FUN=sum)
hist(answ1$x, main = "Total number of steps per day", xlab = "Steps per day", col = "cadetblue2")

```


##Results
 


